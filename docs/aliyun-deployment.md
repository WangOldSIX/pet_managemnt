# é˜¿é‡Œäº‘æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æŒ‡å—è¯¦ç»†è¯´æ˜å¦‚ä½•å°†å® ç‰©ç®¡ç†ç³»ç»Ÿçš„å‰ç«¯å’Œåç«¯éƒ¨ç½²åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨ä¸Šã€‚

### å½“å‰æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å¼€å‘ç¯å¢ƒ                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å‰ç«¯: Vue3 + Vite     â”‚  http://localhost:5173        â”‚
â”‚  åç«¯: FastAPI + Uvicornâ”‚ http://localhost:8000        â”‚
â”‚  æ•°æ®åº“: MySQL          â”‚ 106.15.36.199:3306           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    â†“ éƒ¨ç½²åˆ°

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             ç”Ÿäº§ç¯å¢ƒ (é˜¿é‡Œäº‘æœåŠ¡å™¨)                      â”‚
â”‚                  106.15.36.199                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                        â”‚
â”‚  â”‚   Nginx     â”‚  ç›‘å¬ 80/443 ç«¯å£                     â”‚
â”‚  â”‚   (åå‘ä»£ç†) â”‚                                        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                        â”‚
â”‚         â”‚                                               â”‚
â”‚    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                        â”‚
â”‚    â”‚          â”‚                                        â”‚
â”‚  â”Œâ”€â”€â–¼â”€â”€â”€â”€â”  â”Œâ”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ å‰ç«¯   â”‚  â”‚    åç«¯ (FastAPI)        â”‚               â”‚
â”‚  â”‚é™æ€æ–‡ä»¶â”‚  â”‚    127.0.0.1:8000        â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                    â”‚                                    â”‚
â”‚               â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚               â”‚      MySQL æ•°æ®åº“                 â”‚    â”‚
â”‚               â”‚      localhost:3306              â”‚    â”‚
â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

| ç»„ä»¶ | æŠ€æœ¯ | ç‰ˆæœ¬ |
|------|------|------|
| åç«¯ | Python FastAPI | 3.9+ |
| åç«¯æœåŠ¡å™¨ | Uvicorn | æœ€æ–° |
| å‰ç«¯ | Vue 3 | ^3.4.0 |
| å‰ç«¯æ„å»º | Vite | ^5.0.0 |
| WebæœåŠ¡å™¨ | Nginx | 1.18+ |
| è¿›ç¨‹ç®¡ç† | PM2 | æœ€æ–° |
| æ•°æ®åº“ | MySQL | 8.0+ |

---

## ğŸ”§ éƒ¨ç½²å‰å‡†å¤‡å·¥ä½œ

### 1. æœ¬åœ°ç¯å¢ƒæ£€æŸ¥

ç¡®ä¿æœ¬åœ°å¼€å‘ç¯å¢ƒæ­£å¸¸ï¼š

```bash
# æ£€æŸ¥åç«¯æ˜¯å¦æ­£å¸¸è¿è¡Œ
cd backend
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
python -m uvicorn app.main:app --host 0.0.0.0 --port 8000

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯æ£€æŸ¥å‰ç«¯
cd frontend
npm install
npm run dev
```

### 2. é˜¿é‡Œäº‘æœåŠ¡å™¨ä¿¡æ¯å‡†å¤‡

è¯·ç¡®è®¤ä»¥ä¸‹ä¿¡æ¯ï¼š

- æœåŠ¡å™¨IP: `106.15.36.199`
- SSHç”¨æˆ·: `root` (æˆ–å…¶ä»–æœ‰sudoæƒé™çš„ç”¨æˆ·)
- SSHç«¯å£: `22` (é»˜è®¤)
- æ•°æ®åº“ç«¯å£: `3306`
- æ•°æ®åº“ç”¨æˆ·å: `wxy`
- æ•°æ®åº“å¯†ç : `Wxy123..`
- æ•°æ®åº“å: `pet_management`

### 3. æœåŠ¡å™¨å®‰å…¨ç»„é…ç½®

ç¡®ä¿é˜¿é‡Œäº‘å®‰å…¨ç»„å¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š

| ç«¯å£ | åè®® | ç”¨é€” | æ¥æº |
|------|------|------|------|
| 22 | TCP | SSH | 0.0.0.0/0 æˆ– ä½ çš„IP |
| 80 | TCP | HTTP | 0.0.0.0/0 |
| 443 | TCP | HTTPS | 0.0.0.0/0 |

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤ï¼ˆæ¨èï¼šNginx + PM2ï¼‰

### æ­¥éª¤1: è¿æ¥æœåŠ¡å™¨

```bash
# SSHè¿æ¥åˆ°é˜¿é‡Œäº‘æœåŠ¡å™¨
ssh root@106.15.36.199

# å¦‚æœæç¤ºè¾“å…¥å¯†ç ï¼Œè¾“å…¥æœåŠ¡å™¨å¯†ç 
```

### æ­¥éª¤2: å®‰è£…ç³»ç»Ÿä¾èµ–

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£… Python 3.9+ å’Œç›¸å…³å·¥å…·
sudo apt install python3 python3-pip python3-venv python3-dev -y

# å®‰è£… Node.js 18.x
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install nodejs -y

# éªŒè¯å®‰è£…
python3 --version  # åº”æ˜¾ç¤º Python 3.9+
node --version     # åº”æ˜¾ç¤º v18.x.x
npm --version      # åº”æ˜¾ç¤º 9.x.x

# å®‰è£… Nginx
sudo apt install nginx -y

# å®‰è£… PM2 (è¿›ç¨‹ç®¡ç†å™¨)
sudo npm install -g pm2

# å®‰è£… Git (å¦‚æœéœ€è¦)
sudo apt install git -y
```

### æ­¥éª¤3: åˆ›å»ºé¡¹ç›®ç›®å½•

```bash
# åˆ›å»ºé¡¹ç›®æ ¹ç›®å½•
sudo mkdir -p /opt/pet-management
sudo chown -R $USER:$USER /opt/pet-management

# åˆ›å»ºå­ç›®å½•
cd /opt/pet-management
mkdir -p backend frontend logs
```

### æ­¥éª¤4: éƒ¨ç½²åç«¯

#### æ–¹å¼A: æ‰‹åŠ¨ä¸Šä¼ å¹¶éƒ¨ç½²ï¼ˆé€‚åˆåˆæ¬¡éƒ¨ç½²ï¼‰

åœ¨**æœ¬åœ°ç”µè„‘**æ‰§è¡Œï¼š

```bash
# 1. è¿›å…¥åç«¯ç›®å½•
cd d:/codes/wxy/codes_of_python/Pet_mangement/backend

# 2. æ‰“åŒ…åç«¯ä»£ç ï¼ˆæ’é™¤ä¸å¿…è¦çš„æ–‡ä»¶ï¼‰
tar -czf backend.tar.gz --exclude='venv' --exclude='__pycache__' --exclude='*.pyc' --exclude='.git' .

# 3. ä¸Šä¼ åˆ°æœåŠ¡å™¨
scp backend.tar.gz root@106.15.36.199:/opt/pet-management/

# 4. ä¸Šä¼  requirements.txtï¼ˆå¦‚æœæ²¡æœ‰åŒ…å«åœ¨taråŒ…ä¸­ï¼‰
scp requirements.txt root@106.15.36.199:/opt/pet-management/backend/
```

åœ¨**æœåŠ¡å™¨**æ‰§è¡Œï¼š

```bash
cd /opt/pet-management
tar -xzf backend.tar.gz
rm backend.tar.gz
cd backend

# åˆ›å»ºå¹¶æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# å‡çº§ pip
pip install --upgrade pip

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶
cat > .env << 'EOF'
# æ•°æ®åº“é…ç½®
DATABASE_URL=mysql+pymysql://wxy:Wxy123..@localhost:3306/pet_management

# JWTå¯†é’¥é…ç½®ï¼ˆè¯·ä¿®æ”¹ä¸ºéšæœºç”Ÿæˆçš„å¯†é’¥ï¼‰
SECRET_KEY=$(openssl rand -hex 32)
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30

# CORSé…ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒåªå…è®¸ç‰¹å®šåŸŸåï¼‰
CORS_ORIGINS=http://106.15.36.199

# ç¯å¢ƒé…ç½®
ENVIRONMENT=production
DEBUG=False

# åº”ç”¨é…ç½®
APP_NAME=å® ç‰©ç®¡ç†ç³»ç»Ÿ
APP_VERSION=1.0.0
EOF

# æµ‹è¯•å¯åŠ¨åç«¯ï¼ˆç¡®ä¿æ²¡æœ‰é”™è¯¯ï¼‰
python -m uvicorn app.main:app --host 127.0.0.1 --port 8000

# æŒ‰ Ctrl+C åœæ­¢æµ‹è¯•
```

ä½¿ç”¨ PM2 ç®¡ç†åç«¯è¿›ç¨‹ï¼š

```bash
# åˆ›å»º PM2 é…ç½®æ–‡ä»¶
cat > ecosystem.config.js << 'EOF'
module.exports = {
  apps: [{
    name: 'pet-backend',
    script: 'venv/bin/python',
    args: '-m uvicorn app.main:app --host 127.0.0.1 --port 8000',
    cwd: '/opt/pet-management/backend',
    autorestart: true,
    max_restarts: 10,
    min_uptime: '10s',
    max_memory_restart: '1G',
    env: {
      NODE_ENV: 'production'
    },
    error_file: '/opt/pet-management/logs/backend-error.log',
    out_file: '/opt/pet-management/logs/backend-out.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss Z'
  }]
}
EOF

# å¯åŠ¨åç«¯æœåŠ¡
pm2 start ecosystem.config.js

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs pet-backend

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

#### æ–¹å¼B: ä½¿ç”¨ Git å…‹éš†ï¼ˆå¦‚æœä»£ç å·²æ¨é€åˆ° Gitï¼‰

```bash
cd /opt/pet-management
git clone https://github.com/your-username/pet-management.git backend
cd backend

# åç»­æ­¥éª¤åŒæ–¹å¼A
```

### æ­¥éª¤5: éƒ¨ç½²å‰ç«¯

#### åœ¨æœ¬åœ°æ„å»ºå‰ç«¯

åœ¨**æœ¬åœ°ç”µè„‘**æ‰§è¡Œï¼š

```bash
# 1. è¿›å…¥å‰ç«¯ç›®å½•
cd d:/codes/wxy/codes_of_python/Pet_mangement/frontend

# 2. åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶
cat > .env.production << 'EOF'
VITE_API_BASE_URL=/api
EOF

# 3. ä¿®æ”¹ vite.config.jsï¼ˆå¦‚æœéœ€è¦ï¼‰
# ç¡®ä¿é…ç½®å¦‚ä¸‹ï¼š
cat > vite.config.js << 'EOF'
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import { fileURLToPath, URL } from 'node:url'

export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url))
    }
  },
  base: '/',  // ç”Ÿäº§ç¯å¢ƒåŸºç¡€è·¯å¾„
  server: {
    port: 5173,
    proxy: {
      '/api': {
        target: 'http://localhost:8000',
        changeOrigin: true
      }
    }
  },
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false,  // ç”Ÿäº§ç¯å¢ƒå…³é—­ source map
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true,  // ç§»é™¤ console
        drop_debugger: true
      }
    }
  }
})
EOF

# 4. å®‰è£…ä¾èµ–
npm install

# 5. æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# 6. ä¸Šä¼ æ„å»ºäº§ç‰©åˆ°æœåŠ¡å™¨
scp -r dist/* root@106.15.36.199:/opt/pet-management/frontend/
```

#### åœ¨æœåŠ¡å™¨ä¸ŠéªŒè¯

```bash
# æ£€æŸ¥å‰ç«¯æ–‡ä»¶æ˜¯å¦ä¸Šä¼ æˆåŠŸ
ls -la /opt/pet-management/frontend/

# åº”è¯¥çœ‹åˆ° index.html å’Œ assets æ–‡ä»¶å¤¹
```

### æ­¥éª¤6: é…ç½® Nginx

åœ¨**æœåŠ¡å™¨**ä¸Šåˆ›å»º Nginx é…ç½®ï¼š

```bash
# åˆ›å»º Nginx é…ç½®æ–‡ä»¶
sudo tee /etc/nginx/sites-available/pet-management << 'EOF'
server {
    listen 80;
    server_name 106.15.36.199;  # å¦‚æœæœ‰åŸŸåï¼Œæ”¹ä¸ºåŸŸå

    # è®¿é—®æ—¥å¿—å’Œé”™è¯¯æ—¥å¿—
    access_log /var/log/nginx/pet-management-access.log;
    error_log /var/log/nginx/pet-management-error.log;

    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /opt/pet-management/frontend;
        index index.html;

        # Vue Router history æ¨¡å¼æ”¯æŒ
        try_files $uri $uri/ /index.html;

        # å®‰å…¨å¤´
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-XSS-Protection "1; mode=block" always;
    }

    # åç«¯ API ä»£ç†
    location /api {
        proxy_pass http://127.0.0.1:8000;
        proxy_http_version 1.1;

        # WebSocket æ”¯æŒï¼ˆå¦‚æœéœ€è¦ï¼‰
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';

        # ä¼ é€’çœŸå® IP
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # è¶…æ—¶è®¾ç½®
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;

        # ç¦ç”¨ç¼“å­˜
        proxy_cache_bypass $http_upgrade;
    }

    # é™æ€èµ„æºç¼“å­˜ï¼ˆ1å¹´ï¼‰
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        root /opt/pet-management/frontend;
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    # æ‹’ç»è®¿é—®éšè—æ–‡ä»¶
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
}
EOF

# åˆ›å»ºè½¯é“¾æ¥å¯ç”¨é…ç½®
sudo ln -sf /etc/nginx/sites-available/pet-management /etc/nginx/sites-enabled/

# åˆ é™¤é»˜è®¤é…ç½®ï¼ˆå¯é€‰ï¼‰
sudo rm -f /etc/nginx/sites-enabled/default

# æµ‹è¯• Nginx é…ç½®
sudo nginx -t

# é‡å¯ Nginx
sudo systemctl restart nginx

# è®¾ç½® Nginx å¼€æœºè‡ªå¯
sudo systemctl enable nginx
```

### æ­¥éª¤7: é…ç½®é˜²ç«å¢™

```bash
# å®‰è£…å¹¶å¯ç”¨ UFW é˜²ç«å¢™
sudo apt install ufw -y

# å…è®¸ SSH
sudo ufw allow 22/tcp

# å…è®¸ HTTP
sudo ufw allow 80/tcp

# å…è®¸ HTTPSï¼ˆåç»­é…ç½® SSL æ—¶ï¼‰
sudo ufw allow 443/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable

# æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€
sudo ufw status
```

---

## âœ… éƒ¨ç½²éªŒè¯

### 1. æ£€æŸ¥åç«¯æœåŠ¡

```bash
# æŸ¥çœ‹ PM2 è¿›ç¨‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹åç«¯æ—¥å¿—
pm2 logs pet-backend

# æµ‹è¯•åç«¯ API
curl http://127.0.0.1:8000/health

# åº”è¯¥è¿”å›ï¼š
# {"status":"ok","environment":"production","app_name":"å® ç‰©ç®¡ç†ç³»ç»Ÿ","version":"1.0.0"}
```

### 2. æ£€æŸ¥ Nginx é…ç½®

```bash
# æµ‹è¯• Nginx é…ç½®
sudo nginx -t

# æŸ¥çœ‹ Nginx çŠ¶æ€
sudo systemctl status nginx
```

### 3. ä»å¤–éƒ¨è®¿é—®

åœ¨æµè§ˆå™¨ä¸­è®¿é—®ï¼š

- å‰ç«¯é¡µé¢: `http://106.15.36.199`
- åç«¯å¥åº·æ£€æŸ¥: `http://106.15.36.199/api/health`
- API æ–‡æ¡£: `http://106.15.36.199/api/docs`

### 4. åŠŸèƒ½æµ‹è¯•

- âœ… æ‰“å¼€ç™»å½•é¡µé¢
- âœ… ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•
- âœ… æŸ¥çœ‹ä»ªè¡¨ç›˜æ•°æ®
- âœ… æµ‹è¯•å…¶ä»–åŠŸèƒ½æ¨¡å—

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²

### æ›´æ–°åç«¯

```bash
# åœ¨æœåŠ¡å™¨ä¸Š
cd /opt/pet-management/backend

# æ‹‰å–æœ€æ–°ä»£ç ï¼ˆå¦‚æœä½¿ç”¨ Gitï¼‰
git pull origin main

# æˆ–ä¸Šä¼ æ–°çš„ä»£ç æ–‡ä»¶ï¼ˆåœ¨æœ¬åœ°æ‰§è¡Œï¼‰
scp -r backend/* root@106.15.36.199:/opt/pet-management/backend/

# é‡å¯åç«¯æœåŠ¡
pm2 restart pet-backend

# æŸ¥çœ‹æ—¥å¿—ç¡®è®¤å¯åŠ¨æˆåŠŸ
pm2 logs pet-backend
```

### æ›´æ–°å‰ç«¯

```bash
# åœ¨æœ¬åœ°
cd frontend
npm run build

# ä¸Šä¼ æ„å»ºäº§ç‰©
scp -r dist/* root@106.15.36.199:/opt/pet-management/frontend/

# åœ¨æœåŠ¡å™¨ä¸Šæ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆå¯é€‰ï¼Œå®¢æˆ·ç«¯é‡æ–°è®¿é—®æ—¶ä¼šè‡ªåŠ¨åŠ è½½æ–°æ–‡ä»¶ï¼‰
# å¦‚æœéœ€è¦å¼ºåˆ¶åˆ·æ–°ï¼Œå¯ä»¥é‡å¯ Nginx
sudo systemctl reload nginx
```

---

## ğŸ”’ å®‰å…¨åŠ å›ºå»ºè®®

### 1. é…ç½® HTTPSï¼ˆä½¿ç”¨ Let's Encrypt å…è´¹è¯ä¹¦ï¼‰

```bash
# å®‰è£… Certbot
sudo apt install certbot python3-certbot-nginx -y

# ç”³è¯· SSL è¯ä¹¦ï¼ˆéœ€è¦å…ˆé…ç½®åŸŸåï¼‰
# sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

### 2. ä¿®æ”¹ SSH ç«¯å£ï¼ˆå¯é€‰ï¼‰

```bash
# ç¼–è¾‘ SSH é…ç½®
sudo nano /etc/ssh/sshd_config

# ä¿®æ”¹ç«¯å£å·
Port 2222  # æ”¹ä¸ºå…¶ä»–ç«¯å£

# ç¦ç”¨ root ç™»å½•ï¼ˆå¯é€‰ï¼‰
PermitRootLogin no

# é‡å¯ SSH
sudo systemctl restart sshd
```

### 3. é…ç½®è‡ªåŠ¨å¤‡ä»½

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
cat > /opt/backup-pet-management.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/opt/backups/pet-management"
DATE=$(date +%Y%m%d_%H%M%S)
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
mysqldump -u wxy -p'Wxy123..' pet_management > $BACKUP_DIR/db_$DATE.sql

# å¤‡ä»½é…ç½®æ–‡ä»¶
tar -czf $BACKUP_DIR/config_$DATE.tar.gz /opt/pet-management/backend/.env

# ä¿ç•™æœ€è¿‘7å¤©çš„å¤‡ä»½
find $BACKUP_DIR -type f -mtime +7 -delete
EOF

chmod +x /opt/backup-pet-management.sh

# æ·»åŠ åˆ° crontabï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½ï¼‰
(crontab -l 2>/dev/null; echo "0 2 * * * /opt/backup-pet-management.sh") | crontab -
```

### 4. æ•°æ®åº“å®‰å…¨

```bash
# ä¿®æ”¹æ•°æ®åº“é…ç½®
sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf

# ç»‘å®šåˆ°æœ¬åœ°ï¼ˆåªå…è®¸æœ¬åœ°è®¿é—®ï¼‰
bind-address = 127.0.0.1

# é‡å¯ MySQL
sudo systemctl restart mysql
```

---

## ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

### 1. æŸ¥çœ‹ PM2 æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹
pm2 logs pet-backend

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
pm2 logs pet-backend --err

# æŸ¥çœ‹æœ€è¿‘çš„100è¡Œ
pm2 logs pet-backend --lines 100
```

### 2. æŸ¥çœ‹ Nginx æ—¥å¿—

```bash
# è®¿é—®æ—¥å¿—
sudo tail -f /var/log/nginx/pet-management-access.log

# é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/pet-management-error.log
```

### 3. ç³»ç»Ÿèµ„æºç›‘æ§

```bash
# å®‰è£… htop
sudo apt install htop -y

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h
```

---

## â“ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1: åç«¯å¯åŠ¨å¤±è´¥

**ç—‡çŠ¶**: PM2 æ˜¾ç¤ºæœåŠ¡çŠ¶æ€ä¸º `errored`

**è§£å†³**:
```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
pm2 logs pet-backend --lines 50

# å¸¸è§åŸå› ï¼š
# 1. ä¾èµ–æœªå®‰è£… â†’ é‡æ–°æ‰§è¡Œ pip install -r requirements.txt
# 2. æ•°æ®åº“è¿æ¥å¤±è´¥ â†’ æ£€æŸ¥ .env æ–‡ä»¶ä¸­çš„ DATABASE_URL
# 3. ç«¯å£è¢«å ç”¨ â†’ æ£€æŸ¥ 8000 ç«¯å£æ˜¯å¦è¢«å…¶ä»–ç¨‹åºå ç”¨
sudo lsof -i :8000
```

### é—®é¢˜2: å‰ç«¯é¡µé¢ç©ºç™½

**ç—‡çŠ¶**: æµè§ˆå™¨æ˜¾ç¤ºç©ºç™½é¡µé¢

**è§£å†³**:
```bash
# æ£€æŸ¥å‰ç«¯æ–‡ä»¶æ˜¯å¦æ­£ç¡®ä¸Šä¼ 
ls -la /opt/pet-management/frontend/

# åº”è¯¥çœ‹åˆ° index.html æ–‡ä»¶

# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t

# æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/pet-management-error.log
```

### é—®é¢˜3: API è¯·æ±‚å¤±è´¥ï¼ˆ404ï¼‰

**ç—‡çŠ¶**: å‰ç«¯æ— æ³•è°ƒç”¨åç«¯ API

**è§£å†³**:
```bash
# æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
pm2 status

# æ£€æŸ¥ API è·¯ç”±
curl http://127.0.0.1:8000/health

# æ£€æŸ¥ Nginx ä»£ç†é…ç½®
sudo cat /etc/nginx/sites-available/pet-management | grep -A 10 location /api

# ç¡®è®¤ proxy_pass æŒ‡å‘æ­£ç¡®çš„åœ°å€
```

### é—®é¢˜4: CORS é”™è¯¯

**ç—‡çŠ¶**: æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤º CORS ç›¸å…³é”™è¯¯

**è§£å†³**:
```bash
# æ£€æŸ¥åç«¯ .env æ–‡ä»¶ä¸­çš„ CORS_ORIGINS é…ç½®
cat /opt/pet-management/backend/.env | grep CORS

# ç¡®ä¿åŒ…å«ä½ çš„æœåŠ¡å™¨ IP æˆ–åŸŸå
CORS_ORIGINS=http://106.15.36.199

# é‡å¯åç«¯
pm2 restart pet-backend
```

### é—®é¢˜5: æ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: åç«¯æ—¥å¿—æ˜¾ç¤ºæ•°æ®åº“è¿æ¥é”™è¯¯

**è§£å†³**:
```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
mysql -h 127.0.0.1 -u wxy -p pet_management

# æ£€æŸ¥æ•°æ®åº“æœåŠ¡çŠ¶æ€
sudo systemctl status mysql

# æ£€æŸ¥æ•°æ®åº“é…ç½®
cat /opt/pet-management/backend/.env | grep DATABASE_URL
```

---

## ğŸ“ è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬

ä¸ºäº†ç®€åŒ–éƒ¨ç½²è¿‡ç¨‹ï¼Œå¯ä»¥åˆ›å»ºè‡ªåŠ¨åŒ–è„šæœ¬ï¼š

### deploy.shï¼ˆåœ¨æœ¬åœ°æ‰§è¡Œï¼‰

```bash
#!/bin/bash

set -e  # é‡åˆ°é”™è¯¯ç«‹å³é€€å‡º

# é…ç½®å˜é‡
SERVER_IP="106.15.36.199"
SERVER_USER="root"
BACKEND_DIR="/opt/pet-management/backend"
FRONTEND_DIR="/opt/pet-management/frontend"

echo "ğŸš€ å¼€å§‹éƒ¨ç½²å® ç‰©ç®¡ç†ç³»ç»Ÿ..."

# 1. æ„å»ºå‰ç«¯
echo "ğŸ“¦ [1/4] æ„å»ºå‰ç«¯..."
cd frontend
npm install
npm run build
cd ..

# 2. æ‰“åŒ…åç«¯
echo "ğŸ“¦ [2/4] å‡†å¤‡åç«¯ä»£ç ..."
cd backend
tar -czf backend.tar.gz --exclude='venv' --exclude='__pycache__' --exclude='*.pyc' --exclude='.git' .
cd ..

# 3. ä¸Šä¼ åˆ°æœåŠ¡å™¨
echo "ğŸ“¤ [3/4] ä¸Šä¼ ä»£ç åˆ°æœåŠ¡å™¨..."
scp backend.tar.gz ${SERVER_USER}@${SERVER_IP}:${BACKEND_DIR}/
scp -r frontend/dist/* ${SERVER_USER}@${SERVER_IP}:${FRONTEND_DIR}/

# 4. åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²
echo "ğŸ”§ [4/4] åœ¨æœåŠ¡å™¨ä¸Šé…ç½®..."
ssh ${SERVER_USER}@${SERVER_IP} << 'ENDSSH'
cd /opt/pet-management/backend

# è§£å‹åç«¯ä»£ç 
tar -xzf backend.tar.gz
rm backend.tar.gz

# é‡å¯åç«¯æœåŠ¡
pm2 restart pet-backend

# é‡æ–°åŠ è½½ Nginx
sudo systemctl reload nginx

echo "âœ… éƒ¨ç½²å®Œæˆ!"
ENDSSH

echo "ğŸ‰ éƒ¨ç½²æˆåŠŸ! è®¿é—®: http://${SERVER_IP}"
```

ä½¿ç”¨æ–¹æ³•ï¼š
```bash
# ç»™è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy.sh

# æ‰§è¡Œéƒ¨ç½²
./deploy.sh
```

---

## ğŸ“š é™„å½•

### A. ç›®å½•ç»“æ„

æœåŠ¡å™¨ä¸Šçš„ç›®å½•ç»“æ„ï¼š

```
/opt/pet-management/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ crud/
â”‚   â”‚   â”œâ”€â”€ db/
â”‚   â”‚   â”œâ”€â”€ schemas/
â”‚   â”‚   â””â”€â”€ service/
â”‚   â”œâ”€â”€ venv/                    # Python è™šæ‹Ÿç¯å¢ƒ
â”‚   â”œâ”€â”€ .env                     # ç¯å¢ƒå˜é‡é…ç½®
â”‚   â”œâ”€â”€ ecosystem.config.js      # PM2 é…ç½®
â”‚   â””â”€â”€ requirements.txt         # Python ä¾èµ–
â”‚
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ index.html
â”‚   â”œâ”€â”€ assets/                  # é™æ€èµ„æº
â”‚   â””â”€â”€ (å…¶ä»–å‰ç«¯æ–‡ä»¶)
â”‚
â””â”€â”€ logs/                        # æ—¥å¿—æ–‡ä»¶
    â”œâ”€â”€ backend-error.log
    â”œâ”€â”€ backend-out.log
    â””â”€â”€ (å…¶ä»–æ—¥å¿—)
```

### B. ç«¯å£æ˜ å°„

| æœåŠ¡ | å†…éƒ¨åœ°å€ | å¤–éƒ¨è®¿é—® | è¯´æ˜ |
|------|----------|----------|------|
| Nginx | 80/443 | http://106.15.36.199 | Web æœåŠ¡å…¥å£ |
| FastAPI | 127.0.0.1:8000 | é€šè¿‡ Nginx ä»£ç† | åç«¯ API æœåŠ¡ |
| MySQL | 127.0.0.1:3306 | ä¸å¯¹å¤–å¼€æ”¾ | æ•°æ®åº“æœåŠ¡ |

### C. æœ‰ç”¨çš„å‘½ä»¤

```bash
# PM2 å‘½ä»¤
pm2 list                          # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
pm2 start <name>                 # å¯åŠ¨è¿›ç¨‹
pm2 stop <name>                  # åœæ­¢è¿›ç¨‹
pm2 restart <name>               # é‡å¯è¿›ç¨‹
pm2 delete <name>                # åˆ é™¤è¿›ç¨‹
pm2 monit                        # å®æ—¶ç›‘æ§
pm2 logs <name>                  # æŸ¥çœ‹æ—¥å¿—

# Nginx å‘½ä»¤
sudo nginx -t                    # æµ‹è¯•é…ç½®
sudo systemctl reload nginx      # é‡è½½é…ç½®
sudo systemctl restart nginx     # é‡å¯æœåŠ¡
sudo systemctl status nginx      # æŸ¥çœ‹çŠ¶æ€

# ç³»ç»Ÿå‘½ä»¤
df -h                            # ç£ç›˜ä½¿ç”¨æƒ…å†µ
free -h                          # å†…å­˜ä½¿ç”¨æƒ…å†µ
top / htop                       # è¿›ç¨‹ç›‘æ§
netstat -tlnp                    # æŸ¥çœ‹ç«¯å£å ç”¨
```

---

## ğŸ¯ éƒ¨ç½²æ£€æŸ¥æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·é€é¡¹æ£€æŸ¥ï¼š

- [ ] æœåŠ¡å™¨é˜²ç«å¢™å·²å¼€æ”¾ 80ã€443 ç«¯å£
- [ ] Python 3.9+ å·²å®‰è£…
- [ ] Node.js 18.x å·²å®‰è£…
- [ ] Nginx å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] åç«¯ä¾èµ–å·²å®‰è£…ï¼ˆrequirements.txtï¼‰
- [ ] åç«¯ .env æ–‡ä»¶é…ç½®æ­£ç¡®
- [ ] PM2 åç«¯æœåŠ¡è¿è¡Œæ­£å¸¸
- [ ] å‰ç«¯æ„å»ºäº§ç‰©å·²ä¸Šä¼ 
- [ ] Nginx é…ç½®æ­£ç¡®å¹¶ç”Ÿæ•ˆ
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] å‰ç«¯é¡µé¢å¯æ­£å¸¸è®¿é—®
- [ ] API æ¥å£è°ƒç”¨æ­£å¸¸
- [ ] ç”¨æˆ·ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] æ—¥å¿—è¾“å‡ºæ­£å¸¸
- [ ] é…ç½®äº†è‡ªåŠ¨å¤‡ä»½ï¼ˆå¯é€‰ï¼‰

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœåœ¨éƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶å®šä½é”™è¯¯
2. å‚è€ƒæœ¬æ–‡æ¡£çš„"å¸¸è§é—®é¢˜è§£å†³"éƒ¨åˆ†
3. æ£€æŸ¥æœåŠ¡å™¨èµ„æºä½¿ç”¨æƒ…å†µ

ç¥ä½ éƒ¨ç½²é¡ºåˆ©ï¼ğŸ‰
